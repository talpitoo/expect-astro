<section class="intermission" id="intermission">
  <div class="cursor-follower" id="cursorFollower">
    <img src="/img/eva-pod-cursor64x64.png?ver=28082025" alt="Eva Pod Cursor" />
  </div>
  <div class="container-bootstrap relative min-h-[300px]">
    <div class="grid md:grid-cols-12 -mx-[15px]">
      <div class="md:col-span-10 md:col-start-2 px-[15px]">
        <h2
          class="font-serif font-light leading-[1.1] mb-6 uppercase text-[46px] text-white"
        >
          Inter<wbr />mission
        </h2>
        <p class="mb-3 text-white">
          Read our <a
            onclick="trackOutboundLinkWithDelay('https://cv.tothtamas.tt/'); return false;"
            href="https://cv.tothtamas.tt/"
            class="text-primary">freelancing manifesto</a
          > to see if we're a match.
        </p>
      </div>
    </div>
    <div class="animation-placeholder">
      <div class="animation-spin">
        <a
          class="aspect-square size-11 flex items-center justify-center cursor-grabbing"
          onclick="trackOutboundLinkWithDelay('https://cv.tothtamas.tt/'); return false;"
          href="https://cv.tothtamas.tt/"
          ><i class="overflow-visible!">poole</i></a
        >
      </div>
    </div>
  </div>
</section>

<style>
  .intermission {
    background-color: black;
    overflow: hidden;
    /* cursor:
      url("../img/eva-pod-cursor64x64.png?ver=28082025") 32 32,
      crosshair; */

    @apply cursor-all-scroll;
  }

  .cursor-follower {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
    z-index: 9999;
    width: 64px;
    height: 64px;
    transition: opacity 0.5s;
    will-change: transform;
    opacity: 0;
  }

  .cursor-follower img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  /* Hide cursor follower when hovering over grabbing cursor elements */
  a:hover ~ .cursor-follower,
  .intermission:has(a:hover) .cursor-follower {
    opacity: 0 !important;
  }

  .animation-placeholder a,
  .animation-placeholder a:active,
  .animation-placeholder a:focus,
  .animation-placeholder a:hover {
    color: white;
  }

  /* Dr. Frank Poole */
  .animation-placeholder {
    font-size: 30px;
    cursor: pointer;

    a {
      &,
      &:active,
      &:focus,
      &:hover {
        color: white;
        border-radius: 100%;
        outline-offset: 10px;
      }
    }
  }

  .animation-spin {
    animation: spinZ 4s infinite linear;
    position: absolute;
    right: 100px;
    bottom: 50px;
    color: white;
    font-size: inherit;

    span {
      display: inline-block;
    }
  }

  .animation-flyoff {
    animation: enlarge 2s 1 cubic-bezier(1, 0, 1, 0);
  }

  @keyframes spinX {
    0% {
      transform: rotateX(0deg);
    }

    100% {
      transform: rotateX(180deg);
    }
  }

  @keyframes spinZ {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }

  @keyframes enlarge {
    0% {
      font-size: 30px;
    }

    100% {
      font-size: 3000px;
    }
  }
</style>

<script is:inline>
  (function () {
    // Smooth following without bounce - high damping, low stiffness
    const spring = { damping: 0.15, stiffness: 0.008, restDelta: 0.001 };
    
    // Cursor follower with spring physics
    class SpringFollower {
      constructor(element, container) {
        this.element = element;
        this.container = container;
        this.currentX = 0;
        this.currentY = 0;
        this.targetX = 0;
        this.targetY = 0;
        this.velocityX = 0;
        this.velocityY = 0;
        this.isInContainer = false;
        
        this.bindEvents();
        this.animate();
      }
      
      bindEvents() {
        // Only track mouse when inside the intermission section
        this.container.addEventListener('mouseenter', () => {
          this.isInContainer = true;
          this.element.style.opacity = '1';
        });
        
        this.container.addEventListener('mouseleave', () => {
          this.isInContainer = false;
          this.element.style.opacity = '0';
        });
        
        document.addEventListener('mousemove', (e) => {
          if (this.isInContainer) {
            this.targetX = e.clientX - 32; // Center the 64px image
            this.targetY = e.clientY - 32;
          }
        });
      }
      
      animate() {
        if (this.isInContainer) {
          // Smooth following physics - no bounce, just gradual approach
          const deltaX = this.targetX - this.currentX;
          const deltaY = this.targetY - this.currentY;
          
          // Apply very weak spring force for slow approach
          const forceX = deltaX * spring.stiffness;
          const forceY = deltaY * spring.stiffness;
          
          // Apply strong damping to prevent any oscillation
          this.velocityX += forceX;
          this.velocityY += forceY;
          this.velocityX *= (1 - spring.damping);
          this.velocityY *= (1 - spring.damping);
          
          // Update position
          this.currentX += this.velocityX;
          this.currentY += this.velocityY;
          
          // Apply transform
          this.element.style.transform = `translate3d(${this.currentX}px, ${this.currentY}px, 0)`;
        }
        
        // Continue animation
        requestAnimationFrame(() => this.animate());
      }
    }
    
    // Initialize cursor follower
    const cursorFollower = document.getElementById('cursorFollower');
    const intermissionSection = document.getElementById('intermission');
    if (cursorFollower && intermissionSection) {
      new SpringFollower(cursorFollower, intermissionSection);
    }

    // Dr. Frank Poole
    const animationPlaceholder = document.querySelector(
      ".animation-placeholder"
    );
    if (animationPlaceholder) {
      animationPlaceholder.addEventListener("click", function () {
        this.classList.add("animation-flyoff");
        setTimeout(function () {
          console.debug(
            "setTimeout branch executed for Dr. Frank Poole animation"
          );
          const placeholder = document.querySelector(".animation-placeholder");
          if (placeholder) {
            placeholder.classList.remove("animation-flyoff");
            placeholder.style.display = "none";
          }
        }, 1982);
        if (
          typeof ga !== "undefined" &&
          ga.hasOwnProperty("loaded") &&
          ga.loaded === true
        ) {
          ga("send", "event", "button", "click", "Dr. Frank Poole");
        }
      });
    }
  })();
</script>
